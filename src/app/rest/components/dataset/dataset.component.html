<div class="container-fluid">
  <div *ngIf="dataset$ | async as dataset" class="mt-0 row">
    <div *ngIf="auth.isLoggedIn; else no_staging" class="card col-4">
      <div class="card-header">
        <h5>Your floating files ...</h5>
      </div>
      <div class="card-body">
        <div *ngIf="files$ | async as files" class="list-group-flush">
          <div class="list-group-item list-group-item-action p-0 flex-sm-column align-items-start"
            *ngFor="let file of files" (click)="addFile2Set(dataset.id, file, dataset.modificationDate)">
            <div class="d-flex w-100 py-0 justify-content-between">
              <span class="text-start" [innerHtml]="file.id"></span>
              <input type="submit" class="btn btn-outline-secondary btn-sm"
                (click)="delete(file); $event.stopPropagation()" name="delete" value="x" />
            </div>
            <div class="d-flex w-100 py-0 flex-sm-row justify-content-between">
              <span class="text-start text-truncate text-info" [innerHtml]="file.filename"></span>
              <span class="text-start text-truncate" [innerHtml]="file.format"></span>
              <span class="text-start text-truncate text-primary" [innerHtml]="file.state"></span>
              <span class="text-start text-truncate" [innerHtml]="file.size"></span>
              <input *ngIf="file.state === 'ONGOING'" type="button" class="btn btn-outline-secondary btn-sm"
                (click)="uploadMPU(dataset.id, file); $event.stopPropagation()" name="more" value="more" />
              <input *ngIf="file.state === 'ONGOING'" type="button" class="btn btn-outline-secondary btn-sm"
                (click)="finishMPU(dataset.id, file); $event.stopPropagation()" name="finish" value="finish" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #no_staging>
      <div class="card col-4">
        <div class="card-header">
          <h4>placeholder ...</h4>
        </div>
        <div class="card-body">
        </div>
      </div>
    </ng-template>

    <div class="card col-8">
      <div class="button row" style="font-size: 2rem;">
        <a class="text-secondary col-1" [routerLink]="['/rest/sets']"><i class="bi-list-ol"></i></a>
        <a *ngIf="auth.isLoggedIn" class="text-primary col-1" [routerLink]="['/rest/set-editor', dataset.id]"
          [queryParams]="{lmd:dataset.modificationDate}"><i class="bi-pencil"></i></a>
        <!-- abuse of empty routerLink in order to get a "hand" cursor -->
        <a *ngIf="auth.isLoggedIn && dataset.state != 'PUBLIC'" class="text-info col-1" [routerLink]=""
          (click)="openUploadDialog(dataset)"><i class="bi-cloud-upload" data-toggle="tooltip" data-placement="top"
            title="upload files"></i></a>
        <a *ngIf="auth.isLoggedIn && dataset.state != 'PUBLIC'" class="text-warning col-1" [routerLink]=""
          (click)="initMPUDialog(dataset.id)"><i class="bi-diagram-3" data-toggle="tooltip" data-placement="top"
            title="upload file in chunks"></i></a>
        <a *ngIf="auth.isLoggedIn && dataset.state != 'PUBLIC'" class="text-success col-1" [routerLink]=""
          (click)="publish(dataset.id, dataset.modificationDate)"><i class="bi-unlock" data-toggle="tooltip"
            data-placement="top" title="publish"></i></a>
      </div>
      <div class="card-header">
        <h4>{{dataset?.id}} <b class="text-primary">{{dataset.versionNumber}} </b> <small
            class="text-info">{{dataset?.state}} </small><small>{{dataset.modificationDate}}</small></h4>
      </div>
      <div class="card-body">
        <pre>{{dataset?.metadata | json}}</pre>
        <div *ngIf="dataset?.files" class="list-group-flush">
          <h5>files in this dataset ...</h5>
          <div class="list-group-item list-group-item-action py-0 d-flex flex-sm-row align-items-center"
            *ngFor="let file of dataset?.files" (click)="download(file)">
            <span class="col-sm-4 text-start me-2" [innerHtml]="file.filename"></span>
            <span class="col-sm-4 text-end me-2" [innerHtml]="file.id"></span>
            <span class="col-sm-3 text-start text-truncate" [innerHtml]="file.size"></span>
            <div class="col-sm-1 text-end">
              <input type="submit" class="btn btn-outline-secondary btn-sm"
                (click)="remove(dataset, file); $event.stopPropagation()" name="delete" value="x" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>